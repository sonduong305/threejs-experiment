<!DOCTYPE html>
<html>

<head>
    <meta charset=UTF-8 />
    <link rel="stylesheet" type="text/css" href="styles.css" />
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.115/build/three.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/three@0.115/examples/js/controls/OrbitControls.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.115/examples/js/loaders/GLTFLoader.js"></script>
    <script>
        const key = {
            left: 37,
            up: 38,
            right: 39,
            down: 40
        }
        let scene, camera, renderer, car;

        function init() {

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(34, window.innerWidth / window.innerHeight, 1, 3000);
            camera.position.set(200, 150, 200)
            camera.up.set(0, 1, 0)
            camera.lookAt(0, 0, 0)


            hlight = new THREE.AmbientLight(0x404040, 3);
            scene.add(hlight);

            directionalLight = new THREE.DirectionalLight(0xf17611, 5);
            directionalLight.position.set(-100, 350, 100);
            directionalLight.castShadow = true;
            directionalLight.shadow.radius = 0.001;
            var side = 1000;
            directionalLight.shadow.camera.top = side;
            directionalLight.shadow.camera.bottom = -side;
            directionalLight.shadow.camera.left = side;
            directionalLight.shadow.camera.right = -side;

            scene.add(directionalLight);
            light = new THREE.PointLight(0xf17611, 1);
            light.position.set(0, 300, 500);
            scene.add(light);
            light2 = new THREE.PointLight(0xf17611, 1);
            light2.position.set(500, 100, 0);
            scene.add(light2);
            light3 = new THREE.PointLight(0xf17611, 0.5);
            light3.position.set(0, 100, -500);
            scene.add(light3);
            light4 = new THREE.PointLight(0xf17611, 0.5);
            light4.position.set(-500, 300, 500);
            scene.add(light4);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableRotate = false;
            controls.maxDistance = 500;
            controls.minDistance = 10;
            controls.mouseButtons = {
                LEFT: THREE.MOUSE.PAN,
                MIDDLE: THREE.MOUSE.DOLLY,
                // RIGHT: THREE.MOUSE.PAN
            }
            controls.update()


            let geometry = new THREE.PlaneGeometry(1000, 1000, 0, 300);
            geometry.rotateX(-Math.PI * 0.5); // this is how you can do it
            // let material = new THREE.MeshPhongMaterial({ color: 0x0c2e15, side: THREE.DoubleSide });
            let material = new THREE.MeshPhongMaterial({ color: 0x120d01, side: THREE.DoubleSide });
            let plane = new THREE.Mesh(geometry, material);
            plane.receiveShadow = true;
            scene.add(plane);

            texture = THREE.ImageUtils.loadTexture("./assets/textures/road.jpg");


            geometry = new THREE.PlaneGeometry(80, 1000, 0, 301);
            geometry.rotateX(-Math.PI * 0.5); // this is how you can do it
            material = new THREE.MeshPhongMaterial({ map: texture, side: THREE.DoubleSide });
            plane = new THREE.Mesh(geometry, material);
            plane.receiveShadow = true;
            plane.position.x = 40
            plane.position.y = 1
            scene.add(plane);

            let loader = new THREE.GLTFLoader();
            loader.load('./assets/tree_2/scene.gltf', function (gltf) {
                tree = gltf.scene;
                // tree.scale.set(0.1, 0.1, 0.1);
                tree.scale.set(10, 10, 10);
                tree.position.x = -10
                tree.position.z = 400
                tree.position.y = 10
                gltf.scene.traverse(function (node) {
                    if (node.isMesh) {
                        node.castShadow = true;
                    }

                });
                scene.add(gltf.scene);
                // animate();
            });
            loader.load('./assets/tree_2/scene.gltf', function (gltf) {
                tree = gltf.scene;
                // tree.scale.set(0.1, 0.1, 0.1);
                tree.scale.set(10, 10, 10);
                tree.position.x = -10
                tree.position.z = 60
                tree.position.y = 10
                gltf.scene.traverse(function (node) {
                    if (node.isMesh) {
                        node.castShadow = true;
                    }

                });
                scene.add(gltf.scene);
                // animate();
            });
            loader.load('./assets/tree_2/scene.gltf', function (gltf) {
                tree = gltf.scene;
                // tree.scale.set(0.1, 0.1, 0.1);
                tree.scale.set(10, 10, 10);
                tree.position.x = 100
                tree.position.z = 400
                tree.position.y = 10
                gltf.scene.traverse(function (node) {
                    if (node.isMesh) {
                        node.castShadow = true;
                    }

                });
                scene.add(gltf.scene);
                // animate();
            });
            loader.load('./assets/tree_2/scene.gltf', function (gltf) {
                tree = gltf.scene;
                // tree.scale.set(0.1, 0.1, 0.1);
                tree.scale.set(10, 10, 10);
                tree.position.x = 100
                tree.position.z = 60
                tree.position.y = 10
                gltf.scene.traverse(function (node) {
                    if (node.isMesh) {
                        node.castShadow = true;
                    }

                });
                scene.add(gltf.scene);
                // animate();
            });

            loader.load('./assets/car/scene.gltf', function (gltf) {
                car = gltf.scene;
                car.scale.set(10, 10, 10);
                car.position.z = 0;
                car.position.x = 30;
                car.position.y = 9;
                car.rotateY(Math.PI * 0.17)
                gltf.scene.traverse(function (node) {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }

                });
                scene.add(gltf.scene);
                // animate();
            });

            fogColor = new THREE.Color(0xf5ba19);

            scene.background = fogColor;
            scene.fog = new THREE.Fog(fogColor, 1, 500);


            animate()

        }
        // movement - please calibrate these values
        var xSpeed = 1;
        var ySpeed = 3;

        document.addEventListener("keydown", onDocumentKeyDown, false);
        function onDocumentKeyDown(event) {
            var keyCode = event.which;
            if (keyCode == key.up) {
                console.log('moving-- up')
                car.position.z += ySpeed;
            } else if (keyCode == key.down) {
                console.log('moving--')
                car.position.z -= ySpeed;
            } else if (keyCode == key.left) {
                console.log('moving--')
                car.position.x -= xSpeed;
            } else if (keyCode == key.right) {
                console.log('moving--')
                car.position.x += xSpeed;
            } else if (keyCode == 32) {
                car.position.x -= xSpeed;
                car.position.set(0, 0, 0);
            }
        };

        function animate() {
            requestAnimationFrame(animate);
            camera.lookAt(car.position)
            renderer.render(scene, camera);
        }
        init();
    </script>
</body>

</html>
